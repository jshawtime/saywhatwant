<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI QUEUE MONITOR v1.0</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'VT323', monospace;
      background: #000000;
      color: #00ff00;
      height: 100vh;
      overflow: hidden;
      font-size: 20px;
      line-height: 1.2;
      padding: 20px;
      text-shadow: 0 0 5px #00ff00;
    }
    
    .terminal {
      border: 3px solid #00ff00;
      height: 100%;
      display: grid;
      grid-template-columns: 400px 1fr 500px;
      grid-template-rows: auto 1fr auto;
      gap: 2px;
      background: #001100;
    }
    
    .panel {
      background: #000000;
      border: 1px solid #00ff00;
      padding: 15px;
      overflow-y: auto;
    }
    
    .header {
      grid-column: 1 / -1;
      background: #003300;
      border: 1px solid #00ff00;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .title {
      font-size: 32px;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
      animation: flicker 3s infinite;
    }
    
    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.95; }
      51% { opacity: 1; }
    }
    
    .clock {
      font-size: 24px;
      color: #00cc00;
    }
    
    .left-panel {
      grid-row: 2;
    }
    
    .center-panel {
      grid-row: 2;
    }
    
    .right-panel {
      grid-row: 2;
    }
    
    .footer {
      grid-column: 1 / -1;
      background: #000000;
      border: 1px solid #00ff00;
      padding: 8px 20px;
      display: flex;
      justify-content: space-between;
      font-size: 16px;
    }
    
    .section-title {
      color: #00ff00;
      font-size: 24px;
      margin-bottom: 10px;
      border-bottom: 1px solid #00ff00;
      padding-bottom: 5px;
      text-decoration: none;
    }
    
    .stat-line {
      display: flex;
      justify-content: space-between;
      padding: 5px 0;
      border-bottom: 1px dotted #003300;
    }
    
    .stat-label {
      color: #00cc00;
    }
    
    .stat-value {
      color: #00ff00;
      font-weight: bold;
    }
    
    .queue-item {
      background: #001100;
      border: 1px solid #00ff00;
      padding: 8px;
      margin-bottom: 4px;
      display: flex;
      justify-between;
      align-items: center;
      font-size: 16px;
    }
    
    .queue-item:hover {
      background: #002200;
    }
    
    .priority-critical { border-color: #ff0000; color: #ff0000; }
    .priority-high { border-color: #ffff00; color: #ffff00; }
    .priority-medium { border-color: #00ffff; color: #00ffff; }
    .priority-low { border-color: #00ff00; color: #00ff00; }
    
    .button {
      background: #003300;
      color: #00ff00;
      border: 2px solid #00ff00;
      padding: 8px 16px;
      cursor: pointer;
      font-family: inherit;
      font-size: 16px;
      text-transform: uppercase;
      transition: all 0.1s;
    }
    
    .button:hover {
      background: #00ff00;
      color: #000000;
    }
    
    .button.danger {
      border-color: #ff0000;
      color: #ff0000;
    }
    
    .button.danger:hover {
      background: #ff0000;
      color: #000000;
    }
    
    .empty {
      text-align: center;
      color: #006600;
      padding: 20px;
    }
    
    .blink {
      animation: blink 1s step-end infinite;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
    .command-box {
      background: #001100;
      border: 1px solid #00ff00;
      padding: 10px;
      margin: 10px 0;
      cursor: pointer;
      user-select: all;
    }
    
    .command-box:hover {
      background: #002200;
    }
    
    ::-webkit-scrollbar {
      width: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: #000000;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #00ff00;
      border: 1px solid #000000;
    }
  </style>
</head>
<body>
  <div class="terminal">
    <!-- HEADER -->
    <div class="header">
      <div class="title">┌─ AI QUEUE MONITOR v1.0 ─┐</div>
      <div class="clock" id="clock">00:00:00</div>
    </div>
    
    <!-- LEFT PANEL: System Info -->
    <div class="panel left-panel">
      <div class="section-title">SYSTEM STATUS</div>
      
      <div class="stat-line">
        <span class="stat-label">BOT_LOC:</span>
        <span class="stat-value">~/ai</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">LM_SRV_1:</span>
        <span class="stat-value">10.0.0.102:1234</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">LM_SRV_2:</span>
        <span class="stat-value">10.0.0.100:1234</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">API_HOST:</span>
        <span class="stat-value">bootloaders.workers.dev</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">POLL_INT:</span>
        <span class="stat-value">30s</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">QUEUE_SYS:</span>
        <span class="stat-value">ENABLED</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">ROUTER:</span>
        <span class="stat-value">DISABLED</span>
      </div>
      
      <div class="section-title" style="margin-top: 30px;">PRIORITY BANDS</div>
      <div class="stat-line">
        <span style="color: #ff0000;">█ CRITICAL (0-10):</span>
        <span class="stat-value" id="critical-count">0</span>
      </div>
      <div class="stat-line">
        <span style="color: #ffff00;">█ HIGH (11-30):</span>
        <span class="stat-value" id="high-count">0</span>
      </div>
      <div class="stat-line">
        <span style="color: #00ffff;">█ MEDIUM (31-60):</span>
        <span class="stat-value" id="medium-count">0</span>
      </div>
      <div class="stat-line">
        <span style="color: #00ff00;">█ LOW (61-90):</span>
        <span class="stat-value" id="low-count">0</span>
      </div>
      <div class="stat-line">
        <span style="color: #666666;">█ BG (91-99):</span>
        <span class="stat-value" id="background-count">0</span>
      </div>
      
      <div class="section-title" style="margin-top: 30px;">LAUNCH COMMAND</div>
      <div class="command-box" onclick="copyCommand()">
        <span id="command">cd ~/devrepo/SAYWHATWANTv1/saywhatwant/ai && npm run dev</span>
      </div>
      <button class="button" onclick="copyCommand()" style="width: 100%; margin-top: 10px;">
        [ COPY COMMAND ]
      </button>
    </div>
    
    <!-- CENTER PANEL: Queue List -->
    <div class="panel center-panel">
      <div style="display: flex; justify-between; align-items: center; margin-bottom: 10px;">
        <div class="section-title" style="margin: 0;">QUEUE ITEMS (PRIORITY ORDER)</div>
        <button class="button danger" onclick="clearQueue()">
          [ CLEAR ALL ]
        </button>
      </div>
      
      <div id="queue-list">
        <div class="empty">
          ╔════════════════════════════════════╗<br>
          ║  QUEUE EMPTY - AWAITING DATA...    ║<br>
          ║  START BOT TO SEE LIVE QUEUE       ║<br>
          ╚════════════════════════════════════╝
        </div>
      </div>
    </div>
    
    <!-- RIGHT PANEL: Live Stats -->
    <div class="panel right-panel">
      <div class="section-title">LIVE STATISTICS</div>
      
      <div class="stat-line">
        <span class="stat-label">TOTAL_ITEMS:</span>
        <span class="stat-value" id="total-items">0</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">UNCLAIMED:</span>
        <span class="stat-value" id="unclaimed-items">0</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">PROCESSING:</span>
        <span class="stat-value" id="claimed-items">0</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">THROUGHPUT:</span>
        <span class="stat-value" id="throughput-hour">0/min</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">LAST_POST:</span>
        <span class="stat-value" id="last-success">NEVER</span>
      </div>
      <div class="stat-line">
        <span class="stat-label">AVG_WAIT:</span>
        <span class="stat-value" id="avg-wait">0ms</span>
      </div>
      
      <div class="section-title" style="margin-top: 30px;">QUICK LINKS</div>
      <button class="button" onclick="openAIConsole()" style="width: 100%; margin: 5px 0;">
        [ AI CONSOLE ]
      </button>
      <button class="button" onclick="openQueueMonitor()" style="width: 100%; margin: 5px 0;">
        [ QUEUE MONITOR ]
      </button>
      <button class="button" onclick="openMainApp()" style="width: 100%; margin: 5px 0;">
        [ SAY WHAT WANT ]
      </button>
      
      <div style="margin-top: 30px; padding: 15px; background: #001100; border: 1px solid #00ff00;">
        <div style="color: #00cc00; margin-bottom: 10px;">CONSOLE ACCE</div>
        <div style="color: #00ff00;">PASSWORD: saywhatwant</div>
      </div>
      
      <div style="margin-top: 30px; padding: 15px; background: #001100; border: 1px dashed #00ff00;">
        <div style="color: #00cc00; font-size: 14px;">DATA REFRESH:</div>
        <div style="color: #00ff00; font-size: 16px;">LIVE <span class="blink">█</span></div>
        <div style="color: #006600; font-size: 14px; margin-top: 5px;">AUTO-UPDATE: 3s</div>
      </div>
    </div>
    
    <!-- FOOTER -->
    <div class="footer">
      <div>
        <span style="color: #006600;">STATUS:</span>
        <span id="connection-status">CONNECTING<span class="blink">...</span></span>
      </div>
      <div>
        <span style="color: #006600;">LAST_UPDATE:</span>
        <span id="last-update">--:--:--</span>
      </div>
      <div>
        <span style="color: #006600;">SYSTEM:</span>
        <span>OPERATIONAL</span>
      </div>
    </div>
  </div>
  
  <script>
    let queueItems = [];
    let stats = {
      total: 0,
      unclaimed: 0,
      claimed: 0,
      throughputHour: 0,
      avgWait: 0,
      lastSuccess: null,
      priorityBands: { critical: 0, high: 0, medium: 0, low: 0, background: 0 }
    };
    
    // Update clock
    function updateClock() {
      const now = new Date();
      const time = now.toLocaleTimeString('en-US', { hour12: false });
      document.getElementById('clock').textContent = time;
    }
    setInterval(updateClock, 1000);
    updateClock();
    
    // Fetch real queue data from bot
    async function fetchQueueData() {
      try {
        const response = await fetch('http://localhost:4001/queue-stats');
        if (response.ok) {
          const data = await response.json();
          queueItems = data.items || [];
          stats = data.stats || stats;
          document.getElementById('connection-status').innerHTML = 'CONNECTED <span style="color: #00ff00;">█</span>';
          updateDisplay();
        }
      } catch (error) {
        document.getElementById('connection-status').innerHTML = 'OFFLINE <span class="blink" style="color: #ff0000;">█</span>';
        console.error('Queue connection failed:', error);
      }
    }
    
    function updateDisplay() {
      // Update stats
      document.getElementById('total-items').textContent = stats.total;
      document.getElementById('unclaimed-items').textContent = stats.unclaimed;
      document.getElementById('claimed-items').textContent = stats.claimed;
      document.getElementById('throughput-hour').textContent = stats.throughputHour + '/min';
      document.getElementById('avg-wait').textContent = Math.round(stats.avgWait) + 'ms';
      
      // Update priority bands
      document.getElementById('critical-count').textContent = stats.priorityBands.critical;
      document.getElementById('high-count').textContent = stats.priorityBands.high;
      document.getElementById('medium-count').textContent = stats.priorityBands.medium;
      document.getElementById('low-count').textContent = stats.priorityBands.low;
      document.getElementById('background-count').textContent = stats.priorityBands.background;
      
      // Update last success
      if (stats.lastSuccess) {
        const ago = Math.floor((Date.now() - stats.lastSuccess) / 1000);
        if (ago < 60) {
          document.getElementById('last-success').textContent = ago + 's';
        } else if (ago < 3600) {
          document.getElementById('last-success').textContent = Math.floor(ago / 60) + 'm';
        } else {
          document.getElementById('last-success').textContent = Math.floor(ago / 3600) + 'h';
        }
      }
      
      // Update queue list
      const queueList = document.getElementById('queue-list');
      
      if (queueItems.length === 0) {
        queueList.innerHTML = `
          <div class="empty">
            ╔════════════════════════════════════╗<br>
            ║  QUEUE EMPTY                       ║<br>
            ║  AWAITING MESSAGES...              ║<br>
            ╚════════════════════════════════════╝
          </div>
        `;
      } else {
        queueList.innerHTML = queueItems.map((item, index) => {
          const priorityClass = item.priority <= 10 ? 'priority-critical' :
                               item.priority <= 30 ? 'priority-high' :
                               item.priority <= 60 ? 'priority-medium' : 'priority-low';
          
          const status = item.claimedBy ? '[PROC]' : '[WAIT]';
          const preview = (item.message?.text || 'No message').substring(0, 60);
          
          return `
            <div class="queue-item ${priorityClass}">
              <div style="flex: 1;">
                <span style="color: #006600;">#${index + 1}</span>
                <span style="margin: 0 10px;">P${item.priority}</span>
                <span style="color: #00ccff;">${item.entity?.id || 'unknown'}</span>
                <span style="margin: 0 10px;">${status}</span>
                <div style="color: #00cc00; font-size: 14px; margin-top: 3px;">"${preview}..."</div>
              </div>
              <button class="button danger" onclick="deleteItem('${item.id}')" style="padding: 4px 12px; font-size: 14px;">
                [ X ]
              </button>
            </div>
          `;
        }).join('');
      }
      
      // Update footer
      document.getElementById('last-update').textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
    }
    
    function deleteItem(itemId) {
      if (confirm('DELETE QUEUE ITEM?')) {
        fetch(`http://localhost:4001/queue-delete/${itemId}`, { method: 'POST' })
          .then(() => fetchQueueData())
          .catch(err => alert('DELETE FAILED: ' + err.message));
      }
    }
    
    function clearQueue() {
      if (confirm('⚠️ DANGER: CLEAR ENTIRE QUEUE?\n\nTHIS CANNOT BE UNDONE!')) {
        fetch('http://localhost:4001/queue-clear', { method: 'POST' })
          .then(() => fetchQueueData())
          .catch(err => alert('CLEAR FAILED: ' + err.message));
      }
    }
    
    function copyCommand() {
      const command = document.getElementById('command').textContent;
      navigator.clipboard.writeText(command).then(() => {
        alert('✓ COMMAND COPIED TO CLIPBOARD');
      });
    }
    
    function openAIConsole() {
      window.open('https://saywhatwant.app/ai-console', '_blank');
    }
    
    function openQueueMonitor() {
      window.open('https://saywhatwant.app/queue-monitor', '_blank');
    }
    
    function openMainApp() {
      window.open('https://saywhatwant.app/', '_blank');
    }
    
    // Fetch data every 3 seconds
    setInterval(fetchQueueData, 3000);
    fetchQueueData();
    
    // Initial connection message
    console.log('═══════════════════════════════════════');
    console.log('  AI QUEUE MONITOR v1.0');
    console.log('  Connecting to http://localhost:4001');
    console.log('═══════════════════════════════════════');
  </script>
</body>
</html>