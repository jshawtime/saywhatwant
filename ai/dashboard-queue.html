<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üöÄ Queue Dashboard - AI Bot Control & Monitoring</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'SF Mono', Monaco, monospace;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .card {
      background: #16213e;
      border: 2px solid #4fc3f7;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(79, 195, 247, 0.2);
      margin-bottom: 20px;
    }
    
    h1 {
      color: #4fc3f7;
      font-size: 28px;
      margin-bottom: 5px;
      text-shadow: 0 0 20px rgba(79, 195, 247, 0.5);
    }
    
    h2 {
      color: #4fc3f7;
      font-size: 20px;
      margin: 20px 0 15px 0;
    }
    
    .subtitle {
      color: #888;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .stat-card {
      background: #0f0f0f;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #4fc3f7;
    }
    
    .stat-label {
      color: #888;
      font-size: 12px;
      margin-bottom: 5px;
    }
    
    .stat-value {
      color: #4fc3f7;
      font-size: 24px;
      font-weight: bold;
    }
    
    .queue-list {
      background: #0f0f0f;
      border-radius: 8px;
      max-height: 500px;
      overflow-y: auto;
      padding: 10px;
    }
    
    .queue-item {
      background: #1a1a1a;
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      border-left: 4px solid #4fc3f7;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }
    
    .queue-item:hover {
      background: #252525;
    }
    
    .queue-item.priority-5 { border-color: #f44336; }
    .queue-item.priority-10 { border-color: #ff9800; }
    .queue-item.priority-25 { border-color: #ffeb3b; }
    .queue-item.priority-50 { border-color: #4fc3f7; }
    .queue-item.priority-high { border-color: #9c27b0; }
    
    .queue-item-left {
      flex: 1;
    }
    
    .queue-item-meta {
      display: flex;
      gap: 15px;
      margin-bottom: 5px;
      font-size: 12px;
    }
    
    .queue-position {
      color: #888;
      font-weight: bold;
    }
    
    .queue-priority {
      color: #ff9800;
      font-weight: bold;
    }
    
    .queue-entity {
      color: #4fc3f7;
    }
    
    .queue-message {
      color: #ccc;
      font-size: 13px;
      font-style: italic;
    }
    
    .delete-btn {
      background: #f44336;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }
    
    .delete-btn:hover {
      background: #d32f2f;
      transform: scale(1.05);
    }
    
    .button {
      background: #4fc3f7;
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      margin: 5px;
      font-family: inherit;
    }
    
    .button:hover {
      background: #6dd5ff;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(79, 195, 247, 0.4);
    }
    
    .button.danger {
      background: #f44336;
      color: white;
    }
    
    .button.danger:hover {
      background: #d32f2f;
    }
    
    .button.secondary {
      background: #2a2a2a;
      color: #4fc3f7;
      border: 2px solid #4fc3f7;
    }
    
    .note {
      background: rgba(255, 152, 0, 0.1);
      border-left: 4px solid #ff9800;
      padding: 12px;
      margin: 15px 0;
      border-radius: 4px;
      font-size: 13px;
    }
    
    .success {
      background: rgba(76, 175, 80, 0.1);
      border-left: 4px solid #4caf50;
      padding: 12px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    .empty-state {
      text-align: center;
      color: #666;
      padding: 40px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- MONITORING CARD (TOP - Most Important) -->
    <div class="card">
      <h1>üìä Live Queue Monitoring</h1>
      <div class="subtitle">Real-time priority queue statistics</div>
      
      <!-- Key Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Total Items</div>
          <div class="stat-value" id="total-items">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Unclaimed</div>
          <div class="stat-value" id="unclaimed-items">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Processing</div>
          <div class="stat-value" id="claimed-items">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Throughput (Hour Avg)</div>
          <div class="stat-value" id="throughput-hour">0/min</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Last Success</div>
          <div class="stat-value" id="last-success" style="font-size: 16px;">Never</div>
        </div>
      </div>
      
      <!-- Priority Distribution -->
      <h2>Priority Distribution</h2>
      <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr);">
        <div class="stat-card" style="border-color: #f44336;">
          <div class="stat-label">üî¥ Critical (0-10)</div>
          <div class="stat-value" id="critical-count" style="color: #f44336;">0</div>
        </div>
        <div class="stat-card" style="border-color: #ff9800;">
          <div class="stat-label">üü† High (11-30)</div>
          <div class="stat-value" id="high-count" style="color: #ff9800;">0</div>
        </div>
        <div class="stat-card" style="border-color: #ffeb3b;">
          <div class="stat-label">üü° Medium (31-60)</div>
          <div class="stat-value" id="medium-count" style="color: #ffeb3b;">0</div>
        </div>
        <div class="stat-card" style="border-color: #2196f3;">
          <div class="stat-label">üîµ Low (61-90)</div>
          <div class="stat-value" id="low-count" style="color: #2196f3;">0</div>
        </div>
        <div class="stat-card" style="border-color: #9e9e9e;">
          <div class="stat-label">‚ö™ Background (91-99)</div>
          <div class="stat-value" id="background-count" style="color: #9e9e9e;">0</div>
        </div>
      </div>
      
      <!-- Queue Items List -->
      <div style="display: flex; justify-between; align-items: center; margin-top: 30px;">
        <h2 style="margin: 0;">Queue Items (Processing Order)</h2>
        <button class="button danger" onclick="clearQueue()">
          üóëÔ∏è DANGER: Clear Entire Queue
        </button>
      </div>
      
      <div class="queue-list" id="queue-list">
        <div class="empty-state">
          ‚è∏Ô∏è Queue is empty or waiting for data...<br>
          <span style="font-size: 12px; color: #888;">Start the bot to see live queue items</span>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 15px; color: #666; font-size: 12px;">
        <span id="last-update">Last update: Never</span>
      </div>
    </div>
    
    <!-- CONTROL CARD -->
    <div class="card">
      <h1>üöÄ Bot Control</h1>
      <div class="subtitle">Launch and manage AI bot</div>
      
      <div class="note">
        <strong>üìã Copy command and paste in Terminal</strong>
      </div>
      
      <div style="background: #0f0f0f; padding: 15px; border-radius: 8px; margin: 15px 0; cursor: pointer; border: 1px solid #333;" onclick="copyCommand()">
        <code style="color: #4caf50; user-select: all;" id="command">cd ~/devrepo/SAYWHATWANTv1/saywhatwant/ai && npm run dev</code>
      </div>
      
      <div style="margin-top: 20px;">
        <button class="button" onclick="copyCommand()">
          üìã Copy Command
        </button>
        <button class="button secondary" onclick="openTerminal()">
          üñ•Ô∏è Open Terminal
        </button>
      </div>
      
      <h2>Monitoring Links</h2>
      <div style="margin-top: 15px;">
        <button class="button" onclick="openAIConsole()">
          üñ•Ô∏è AI Console
        </button>
        <button class="button" onclick="openQueueMonitor()">
          üìä Queue Monitor
        </button>
        <button class="button" onclick="openMainApp()">
          üí¨ Say What Want
        </button>
      </div>
      
      <div class="note" style="margin-top: 20px;">
        <strong>Password for web consoles:</strong> saywhatwant
      </div>
    </div>
    
    <!-- INFO CARD -->
    <div class="card">
      <h1>‚ÑπÔ∏è System Information</h1>
      
      <div style="background: #0f0f0f; padding: 20px; border-radius: 8px; margin-top: 15px;">
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 13px;">
          <div>
            <span style="color: #888;">Bot Location:</span>
            <div style="color: #4fc3f7; margin-top: 5px;">saywhatwant/ai</div>
          </div>
          <div>
            <span style="color: #888;">LM Studio Servers:</span>
            <div style="color: #4fc3f7; margin-top: 5px;">10.0.0.102, 10.0.0.100</div>
          </div>
          <div>
            <span style="color: #888;">API Endpoint:</span>
            <div style="color: #4fc3f7; margin-top: 5px; font-size: 11px;">sww-comments.bootloaders.workers.dev</div>
          </div>
          <div>
            <span style="color: #888;">Polling Interval:</span>
            <div style="color: #4fc3f7; margin-top: 5px;">30 seconds</div>
          </div>
          <div>
            <span style="color: #888;">Queue System:</span>
            <div style="color: #4caf50; margin-top: 5px;">‚úÖ ENABLED</div>
          </div>
          <div>
            <span style="color: #888;">Router LLM:</span>
            <div style="color: #888; margin-top: 5px;">‚è∏Ô∏è Disabled (Future)</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    // Mock data for testing - will be replaced with real queue connection
    let queueItems = [];
    let stats = {
      total: 0,
      unclaimed: 0,
      claimed: 0,
      throughputHour: 0,
      lastSuccess: null,
      priorityBands: {
        critical: 0,
        high: 0,
        medium: 0,
        low: 0,
        background: 0
      }
    };
    
    function updateDisplay() {
      // Update stats
      document.getElementById('total-items').textContent = stats.total;
      document.getElementById('unclaimed-items').textContent = stats.unclaimed;
      document.getElementById('claimed-items').textContent = stats.claimed;
      document.getElementById('throughput-hour').textContent = stats.throughputHour + '/min';
      
      // Update last success
      if (stats.lastSuccess) {
        const ago = Math.floor((Date.now() - stats.lastSuccess) / 1000);
        if (ago < 60) {
          document.getElementById('last-success').textContent = ago + 's ago';
        } else if (ago < 3600) {
          document.getElementById('last-success').textContent = Math.floor(ago / 60) + 'm ago';
        } else {
          document.getElementById('last-success').textContent = Math.floor(ago / 3600) + 'h ago';
        }
      }
      
      // Update priority distribution
      document.getElementById('critical-count').textContent = stats.priorityBands.critical;
      document.getElementById('high-count').textContent = stats.priorityBands.high;
      document.getElementById('medium-count').textContent = stats.priorityBands.medium;
      document.getElementById('low-count').textContent = stats.priorityBands.low;
      document.getElementById('background-count').textContent = stats.priorityBands.background;
      
      // Update queue list
      const queueList = document.getElementById('queue-list');
      
      if (queueItems.length === 0) {
        queueList.innerHTML = `
          <div class="empty-state">
            ‚è∏Ô∏è Queue is empty<br>
            <span style="font-size: 12px; color: #888;">Waiting for new messages to process</span>
          </div>
        `;
      } else {
        queueList.innerHTML = queueItems.map((item, index) => `
          <div class="queue-item priority-${item.priority}">
            <div class="queue-item-left">
              <div class="queue-item-meta">
                <span class="queue-position">#${index + 1}</span>
                <span class="queue-priority">P${item.priority}</span>
                <span class="queue-entity">${item.entity}</span>
                <span style="color: #666;">${item.claimed ? '‚ö° Processing' : '‚è≥ Waiting'}</span>
              </div>
              <div class="queue-message">"${item.messagePreview}"</div>
            </div>
            <button class="delete-btn" onclick="deleteItem('${item.id}')">
              ‚úï Delete
            </button>
          </div>
        `).join('');
      }
      
      // Update last update time
      document.getElementById('last-update').textContent = 'Last update: ' + new Date().toLocaleTimeString();
    }
    
    function deleteItem(itemId) {
      if (confirm('Delete this queue item?')) {
        // TODO: Send delete request to bot
        console.log('Delete item:', itemId);
        alert('Delete functionality will be connected to bot queue service');
      }
    }
    
    function clearQueue() {
      if (confirm('‚ö†Ô∏è DANGER: Clear the entire queue? This cannot be undone!')) {
        // TODO: Send clear request to bot
        console.log('Clear entire queue');
        queueItems = [];
        stats.total = 0;
        stats.unclaimed = 0;
        stats.claimed = 0;
        updateDisplay();
        alert('Clear queue functionality will be connected to bot queue service');
      }
    }
    
    function copyCommand() {
      const command = document.getElementById('command').textContent;
      navigator.clipboard.writeText(command).then(() => {
        alert('‚úì Command copied to clipboard!');
      });
    }
    
    function openTerminal() {
      window.location.href = 'file:///Applications/Utilities/Terminal.app';
    }
    
    function openAIConsole() {
      window.open('https://saywhatwant.app/ai-console', '_blank');
    }
    
    function openQueueMonitor() {
      window.open('https://saywhatwant.app/queue-monitor', '_blank');
    }
    
    function openMainApp() {
      window.open('https://saywhatwant.app/', '_blank');
    }
    
    // Simulate data updates (will be replaced with real connection)
    function simulateData() {
      // Mock queue items
      queueItems = [
        {
          id: 'req-1',
          priority: 5,
          entity: 'curious',
          messagePreview: 'FearAndLoathing: What do you think about...',
          claimed: false
        },
        {
          id: 'req-2',
          priority: 10,
          entity: 'philosopher',
          messagePreview: 'TheEternal: I wonder if...',
          claimed: false
        },
        {
          id: 'req-3',
          priority: 25,
          entity: 'tech',
          messagePreview: 'Alice: How does this work?',
          claimed: false
        },
        {
          id: 'req-4',
          priority: 50,
          entity: 'sage',
          messagePreview: 'Bob: Interesting conversation...',
          claimed: true
        }
      ];
      
      stats = {
        total: 4,
        unclaimed: 3,
        claimed: 1,
        throughputHour: 5,
        lastSuccess: Date.now() - 45000,  // 45 seconds ago
        priorityBands: {
          critical: 1,
          high: 2,
          medium: 1,
          low: 0,
          background: 0
        }
      };
      
      updateDisplay();
    }
    
    // Initialize
    updateDisplay();
    
    // Auto-refresh every 3 seconds
    setInterval(() => {
      // TODO: Fetch real data from bot
      // For now, simulate
      if (Math.random() < 0.3) {
        simulateData();
      }
      updateDisplay();
    }, 3000);
    
    // Note about real integration
    console.log('üìä Queue Dashboard loaded');
    console.log('üí° To connect to real queue:');
    console.log('   - Bot needs to expose HTTP endpoint or WebSocket');
    console.log('   - Or write stats to JSON file periodically');
    console.log('   - Dashboard will poll that data source');
  </script>
</body>
</html>